pw.component.register("mutable",function(e,t){this.mutation=function(t){if(!window.socket)return void e.node.submit();var o=pw.util.dup(t);delete o.__nested,delete o.scope,delete o.id;var n={action:"call-route"};if("FORM"===e.node.tagName){if(e.node.querySelector('input[type="file"]'))return void e.node.submit();var i,r=e.node.querySelector('input[name="_method"]');i=r?r.value:e.node.getAttribute("method"),n.method=i,n.uri=e.node.getAttribute("action"),n.input=pw.node.serialize(e.node)}else{var a={};a[t.scope]=o,n.input=a}var d=this;window.socket.send(n,function(e){if(302===e.status){var t=e.headers.Location;t!=window.location.pathname||window.context&&"default"===window.context.name?history.pushState({uri:t},t,t):history.pushState({uri:t},t,t)}else{if(400===e.status)return;d.state.rollback()}pw.component.broadcast("response:received",{response:e}),d.revert()})}});
